# 无线网络监听

### 无线网络连接过程
- AP定时广播Beacon帧
- STA 发送Probe Request帧
- AP回复Probe Request帧
- STA发送Authentication - Request请求身份认证
- AP回复Authentication Request帧
- STA发送Association - Request请求连接
- AP回复Association Response帧

### 实验过程
- 使用命令ifconfig查看无线网卡是否处于启用状态

![image](https://github.com/CUCCS/2018-NS-Public-PWHL/blob/MIS2/mis_picture/2.png)

- 使用命令 airmon-ng start wlan0设置wlan0处于监听模式

![image](https://github.com/CUCCS/2018-NS-Public-PWHL/blob/MIS2/mis_picture/1.png)

- 使用iwconfig查看无线网卡是否切换到监听模式

![image](https://github.com/CUCCS/2018-NS-Public-PWHL/blob/MIS2/mis_picture/3.png)

- 使用iwlist wlanmon channel查看无线网卡监听的信道

![image](https://github.com/CUCCS/2018-NS-Public-PWHL/blob/MIS2/mis_picture/4.png)

- 终端运行airodump-ng wlan0mon -w saved 进行抓包

![image](https://github.com/CUCCS/2018-NS-Public-PWHL/blob/MIS2/mis_picture/5.png)

### 实验练习题
 - 查看统计当前信号覆盖范围内一共有多少独立的SSID？其中是否包括隐藏SSID？哪些无线热点是加密/非加密的？加密方式是否可知？
   - 一共有17个独立的SSID，包含隐藏的SSID。CUC-Guest、CMCC-WEB、and-Business 是非加密的，CUC-WIFI、360免费WIFI-40是加密的，加密方式为WPA2
   - 隐藏的SSID，在终端显示beacons为0，有流量，且ESSID为0
  
  ![image](https://github.com/CUCCS/2018-NS-Public-PWHL/blob/MIS2/mis_picture/8.png)
  ![image](https://github.com/CUCCS/2018-NS-Public-PWHL/blob/MIS2/mis_picture/6.png)

   - 要查看该SSID是否加密，查看对应的Beacon frame 的 fixed parameters-Capabilities Information-Privacy 字段是0还是1 ，若Privacy字段值为1表示为启用加密,则说明AP为加密模式。
  
  ![image](https://github.com/CUCCS/2018-NS-Public-PWHL/blob/MIS2/mis_picture/9.png)

  ![image](https://github.com/CUCCS/2018-NS-Public-PWHL/blob/MIS2/mis_picture/10.png)

- 如何分析出一个指定手机在抓包时间窗口内在手机端的无线网络列表可以看到哪些SSID？这台手机尝试连接了哪些SSID？最终加入了哪些SSID？
  - 通过查看当前无线网络覆盖范围有多少beacon帧，或查看回复给该手机的Probe Response 帧，可以知道该手机总共可以看到的SSID
  - 查看手机发送的authentication帧，可看到该手机连接的SSID
  - 查看手机收到的Association Response可判断手机最终加入的SSID
    - 先在终端输入airodump-np wlan0mon  
    - 接入MAC地址为1C:DD:EA:7A:A1:FD的AP，信道为6
    - 使用wlam.fc.sub_type==11过滤数据包，发现手机向MAC地址为1c:dd:ea:7a:a1:fd发出请求，证明手机试图连接该AP
    ![image](https://github.com/CUCCS/2018-NS-Public-PWHL/blob/MIS2/mis_picture/12.png)

    - 使用wlam.fc.sub_type==1过滤数据包，发现AP向我发送Association Response，证明手机成功连接该AP
    ![image](https://github.com/CUCCS/2018-NS-Public-PWHL/blob/MIS2/mis_picture/13.png)
- SSID包含在哪些类型的802.11帧？
  - Probe Request frame
  - Probe Response frame
  - Beacon frame
  - Authencition Request frame
  - Authencition Responce frame
  

- 参考资料
   - https://www.cnblogs.com/darkpig/p/5864116.html（802.11帧格式）
   - https://github.com/CUCCS/2018-NS-Public-jackcily/tree/mis_chapt0x02
   - https://github.com/CUCCS/2018-NS-Public-FLYFLY-H/tree/misch0x02